{% extends 'Base/base.html' %}

{% block title %}
Dashboard
{% endblock %}

{% block content %}
<h1 class="dashboard-header">Current System Status</h1>
<div class="current-status-wrapper">
	<div class="status-bar-container">
		<label for="temperature-status-bar">
			Temperature:
		</label>
		<div id="temperature-status-bar-outer" class="status-bar-outer">
			<div id="temperature-status-bar-inner" class="status-bar-inner tooltip-wrapper">
				<span class="tooltip-text">{{healthy_temperature_label}}</span>
			</div>
			<div id="temperature-current-level-bar" class="current-level-bar tooltip-wrapper">
			</div>
		</div>
	</div>

	<div class="status-bar-container">
		<label for="humidity-status-bar">
			Humidity:
		</label>
		<div id="humidity-status-bar-outer" class="status-bar-outer">
			<div id="humidity-status-bar-inner" class="status-bar-inner tooltip-wrapper">
				<span class="tooltip-text">{{healthy_humidity_label}}</span>
			</div>
			<div id="humidity-current-level-bar" class="current-level-bar">
			</div>
		</div>
	</div>

	<div class="status-bar-container">
		<label for="soil-moisture-status-bar">
			Soil Moisture:
		</label>
		<div id="soil-moisture-status-bar-outer" class="status-bar-outer">
			<div id="soil-moisture-status-bar-inner" class="status-bar-inner tooltip-wrapper">
				<span class="tooltip-text">{{healthy_soil_moisture_label}}</span>
			</div>
			<div id="soil-moisture-current-level-bar" class="current-level-bar">
			</div>
		</div>
	</div>

	<div class="status-bar-container">
		<label for="sunlight-status-bar">
			Sunlight:
		</label>
		<div id="sunlight-status-bar-outer" class="status-bar-outer">
			<div id="sunlight-status-bar-inner" class="status-bar-inner tooltip-wrapper">
				<span class="tooltip-text">{{healthy_sunlight_label}}</span>
			</div>
			<div id="sunlight-current-level-bar" class="current-level-bar">
			</div>
		</div>
	</div>
</div>

<h1 class="dashboard-header">Historical System Status</h1>
<div id="container" class="historical-status-container">
	<canvas id="historical-status"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script>
	var healthyTemperature = Number("{{healthy_temperature}}");
	var healthyTemperatureMargin = ((healthyTemperature - 1) * 100).toString();
	document.getElementById("temperature-status-bar-inner").style.marginLeft = healthyTemperatureMargin.concat("px");

	var currentTemperature = "{{temperatures}}".split(',').slice(-1) * 100; // This number should be the temperature, scaled to range [0, 500]
	var currentTemperatureMargin = (currentTemperature - 100 - healthyTemperatureMargin).toString();
	document.getElementById("temperature-current-level-bar").style.marginLeft = currentTemperatureMargin.concat("px");

	var healthyHumidity = Number("{{healthy_humidity}}");
	var healthyHumidityMargin = ((healthyHumidity - 1) * 100).toString();
	document.getElementById("humidity-status-bar-inner").style.marginLeft = healthyHumidityMargin.concat("px");

	var currentHumidity = "{{humidities}}".split(',').slice(-1) * 100; // This number should be the humidity, scaled to range [0, 500]
	var currentHumidityMargin = (currentHumidity - 100 - healthyHumidityMargin).toString();
	document.getElementById("humidity-current-level-bar").style.marginLeft = currentHumidityMargin.concat("px");

	var healthySoilMoisture = Number("{{healthy_soil_moisture}}");
	var healthySoilMoistureMargin = ((healthySoilMoisture - 1) * 100).toString();
	document.getElementById("soil-moisture-status-bar-inner").style.marginLeft = healthySoilMoistureMargin.concat("px");

	var currentSoilMoisture = "{{soil_moistures}}".split(',').slice(-1) * 100; // This number should be the soil moisture, scaled to range [0, 500]
	var currentSoilMoistureMargin = (currentSoilMoisture - 100 - healthySoilMoistureMargin).toString();
	document.getElementById("soil-moisture-current-level-bar").style.marginLeft = currentSoilMoistureMargin.concat("px");

	var healthySunlight = Number("{{healthy_sunlight}}");
	var healthySunlightMargin = ((healthySunlight - 1) * 100).toString();
	document.getElementById("sunlight-status-bar-inner").style.marginLeft = healthySunlightMargin.concat("px");

	var currentSunlight = "{{sunlights}}".split(',').slice(-1) * 100; // This number should be the sunlight, scaled to range [0, 500]
	var currentSunlightMargin = (currentSunlight - 100 - healthySunlightMargin).toString();
	document.getElementById("sunlight-current-level-bar").style.marginLeft = currentSunlightMargin.concat("px");

	var chart_config = {
		type: 'line',
		data: {
			datasets: [
				{
					data: "{{temperatures}}".split(',').slice(-10),
					backgroundColor: 'lightgreen',
					borderColor: 'lightgreen',
					label: 'Temperature',
					fill: 'false'
				},
				{
					data: "{{humidities}}".split(',').slice(-10),
					backgroundColor: 'green',
					borderColor: 'green',
					label: 'Humidity',
					fill: 'false'
				},
				{
					data: "{{soil_moistures}}".split(',').slice(-10),
					backgroundColor: 'lightseagreen',
					borderColor: 'lightseagreen',
					label: 'Soil Moisture',
					fill: 'false'
				},
				{
					data: "{{sunlights}}".split(',').slice(-10),
					backgroundColor: 'darkseagreen',
					borderColor: 'darkseagreen',
					label: 'Sunlight',
					fill: 'false'
				}
			],
			labels: "{{labels}}".split(',').slice(-10)
		},
		options: {
			responsive: true,
			tooltips: {
				mode: 'index',
				intersect: false,
			},
			hover: {
				mode: 'nearest',
				intersect: true
			},
			scales: {
				xAxes: [{
					display: true,
					scaleLabel: {
						display: true,
						labelString: 'Time'
					}
				}],
				yAxes: [{
					display: true,
					scaleLabel: {
						display: true,
						labelString: 'Value'
					}
				}]
			}
		}
	};

	window.onload = function() {
		var chart_element = document.getElementById('historical-status').getContext('2d');
		window.chart = new Chart(chart_element, chart_config);
	};
</script>
{% endblock %}